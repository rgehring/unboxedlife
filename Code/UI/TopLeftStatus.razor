@using System.Linq
@using System
@using Sandbox
@using Sandbox.UI
@using UnboxedLife
@inherits Panel

<root class="status">
    <ResourceRow Label="Money" Value="@Money.ToString()" />
</root>

@code
{
    GameObject _state;
    BankAccount _bank;

    int Money => _bank?.Money ?? 0;

    void EnsureRefs()
    {
        if (_state?.IsValid() == true && _bank?.IsValid() == true)
            return;

        // Local PlayerState = owned by this connection (same pattern as BottomLeftVitals)
        _state = Scene.GetAllObjects(true)
            .FirstOrDefault(go =>
                go.Network?.IsOwner == true &&
                go.Components.Get<BankAccount>() != null);

        _bank = _state?.Components.Get<BankAccount>();
    }

    protected override int BuildHash()
    {
        EnsureRefs();
        return HashCode.Combine(Money);
    }
}
